

## Решение

1. Хранение состояния должно быть в `Storage`, а `Service` должен быть без состояния.
2. Мы добавим дополнительную логику к `Storage` (см. `BlockStorage`) из-за необходимости локальных изменений состояния системы.
3. Проверка DAG-блока будет осуществляться отдельным сервисом (без состояния), который будет иметь единственную ответственность и может зависеть от `BlockStorage`, чтобы выполнить необходимую проверку.
4. Принятие DAG-блока будет осуществляться в `BlockService`, который будет агрегировать дополнительные зависимости.
5. `BlockStorage` будет содержать методы обновления (методы, которые изменяют состояние) закрытыми для пакета, если это возможно, публикуя только методы получения.
6. Разделим логику сервиса на более мелкие сервисы, если это потребуется.

## Последствия

`Storage` больше не будет чистым шаблоном репозитория. Мы согласны, что можем добавить некоторую дополнительную логику к `Storage`, чтобы сохранить локальные изменения состояния. Если нет необходимости в такой логике, мы должны сохранить `Storage` чистым.
